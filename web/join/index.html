<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>캐시핑 초대 링크</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Pretendard', 'Noto Sans',
          'Apple SD Gothic Neo', sans-serif;
        margin: 0;
        padding: 24px;
        background: #f8fafc;
        color: #0f172a;
      }
      main {
        max-width: 600px;
        margin: 0 auto;
        background: #fff;
        border-radius: 18px;
        padding: 28px 24px;
        box-shadow: 0 18px 45px rgba(15, 23, 42, 0.08);
      }
      h1 {
        font-size: 1.5rem;
        margin-bottom: 12px;
      }
      p {
        line-height: 1.5;
        color: #475569;
      }
      .actions {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 20px;
      }
      button,
      a.button {
        border: none;
        border-radius: 12px;
        padding: 14px 18px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
      }
      button.primary,
      a.button.primary {
        background: #f97316;
        color: #fff;
      }
      button.secondary,
      a.button.secondary {
        background: #e2e8f0;
        color: #0f172a;
      }
      .token-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: #f1f5f9;
        border-radius: 999px;
        padding: 6px 14px;
        font-family: 'Roboto Mono', 'Noto Sans Mono', monospace;
        font-size: 0.85rem;
        color: #334155;
        margin-top: 10px;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>캐시핑 앱에서 열고 있어요</h1>
      <p>
        잠시만 기다려 주세요. 자동으로 캐시핑 앱이 열리지 않으면 아래
        버튼으로 직접 실행하거나, Google Play에서 앱을 설치해 주세요.
      </p>
      <div id="tokenBadge" class="token-badge" hidden></div>
      <div class="actions">
        <button class="primary" id="openAppButton">앱에서 계속하기</button>
        <a
          class="button secondary"
          id="openStoreButton"
          href="https://play.google.com/store/apps/details?id=com.aihaejwo.cashping"
        >
          앱이 없어요 · 설치하기
        </a>
      </div>
    </main>

    <script>
      (function () {
        const playStoreUrl =
          'https://play.google.com/store/apps/details?id=com.aihaejwo.cashping';

        function extractToken() {
          const pathSegments = window.location.pathname
            .split('/')
            .filter(Boolean);
          const joinIndex = pathSegments.indexOf('join');
          if (joinIndex !== -1 && pathSegments.length > joinIndex + 1) {
            return pathSegments[joinIndex + 1];
          }

          const params = new URLSearchParams(window.location.search);
          return params.get('token') || params.get('t') || null;
        }

        const token = extractToken();
        const tokenBadge = document.getElementById('tokenBadge');
        if (token) {
          tokenBadge.hidden = false;
          tokenBadge.textContent = `초대 코드: ${token}`;
        }

        function buildAppUrls() {
          const query = token ? `?token=${encodeURIComponent(token)}` : '';
          const schemeUrl = `cashping://invite${query}`;
          const intentUrl =
            `intent://invite${query}` +
            '#Intent;scheme=cashping;package=com.aihaejwo.cashping;end';
          return { schemeUrl, intentUrl };
        }

        function openApp() {
          const { schemeUrl, intentUrl } = buildAppUrls();
          const isAndroid = /Android/i.test(navigator.userAgent);
          const targetUrl = isAndroid ? intentUrl : schemeUrl;
          window.location.href = targetUrl;
        }

        document
          .getElementById('openAppButton')
          .addEventListener('click', openApp);

        // 기본적으로 자동 실행 시도 + 1.5초 후 스토어 안내
        openApp();
        setTimeout(() => {
          window.location.href = playStoreUrl;
        }, 1500);
      })();
    </script>
  </body>
</html>
